r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("www.","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("http://","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("https://","", x))
r_all_urls[grepl("}", r_all_urls$domain)]$domain <- ""
setkey(r_all_urls, domain)
r_all_urls <- merge(r_all_urls, dt_reward, all.x=TRUE)
r_all_urls[is.na(vert_code)]$reward <- 0
r_all_urls <- subset(r_all_urls, select=-c(url.y, vert_code))
r_all_urls$cum_reward <- cumsum(r_all_urls$reward)
setkey(r_all_urls, step)
unique_rewards <- subset(r_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
r_all_urls <- merge(r_all_urls, unique_rewards, all.x=TRUE)
r_all_urls[1]$unique_reward_count <- ifelse(is.na(r_all_urls[1]$unique_reward_count), 0, 1)
r_all_urls$unique_reward_count <- na.locf(r_all_urls$unique_reward_count)
## Combine and plot rewards
dqn_all_urls$type <- "Q-learning Agent"
r_all_urls$type <- "Random Crawler"
results_df <- rbind(dqn_all_urls, r_all_urls)
g_reward <- ggplot(data=results_df, aes(x=step, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward', color='')
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
## Combine and plot unique rewards
g_uniq <- ggplot(data=results_df, aes(x=step, y=unique_reward_count, color=type))
g_uniq <- g_uniq + geom_line(size=0.9) + labs(x='Pages Crawled', y='Unique Rewards')
g_uniq <- g_uniq + theme(legend.position="top")
g_uniq <- g_uniq + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
##-------------------------------------- Combine plots
# Share legend function
grid_arrange_shared_legend <- function(..., nrow = 1, ncol = length(list(...)), position = c("bottom", "right")) {
plots <- list(...)
position <- match.arg(position)
g <- ggplotGrob(plots[[1]] + theme(legend.position = position))$grobs
legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
lheight <- sum(legend$height)
lwidth <- sum(legend$width)
gl <- lapply(plots, function(x) x + theme(legend.position = "none"))
gl <- c(gl, nrow = nrow, ncol = ncol)
combined <- switch(position,
"bottom" = arrangeGrob(do.call(arrangeGrob, gl),
legend,
ncol = 1,
heights = unit.c(unit(1, "npc") - lheight, lheight)),
"right" = arrangeGrob(do.call(arrangeGrob, gl),
legend,
ncol = 2,
widths = unit.c(unit(1, "npc") - lwidth, lwidth)))
grid.newpage()
grid.arrange(combined)
}
# Combine
g <- grid_arrange_shared_legend(g_reward, g_uniq, nrow = 1, ncol = 2)
g
View(results_df)
View(df)
class(df$pages_crawled)
class(df$total_reward)
class(results_df$cum_reward)
g_reward <- ggplot(data=results_df, aes(x=step, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward', color=type)
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
g_reward <- ggplot(data=results_df, aes(x=step, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward')
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
g_reward
View(results_df)
subset(results_df, select=c(step, cum_reward))
View(subset(results_df, select=c(step, cum_reward)))
library(data.table)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(zoo)
#-------------------- Read random train results data
# random_results <- read.csv("results/random_crawler_results_backlinks.csv")
random_results <- read.csv("results/random_crawler_results/random_crawler_results_revisit.csv")
random_results$type <- "Random Crawler"
# dqn_results <- read.csv("results/dqn_crawler_train_results_backlinks.csv")
dqn_results <- read.csv("results/linear_dqn_results/dqn_crawler_train_results_revisit.csv")
# dqn_results <- read.csv("results/dqn_crawler_test_results.csv")
dqn_results$type <- "Q-Learning Agent"
df <- rbind(random_results, subset(dqn_results, select=-c(nn_loss)))
# df <- rbind(random_results, dqn_results)
df$type <- factor(df$type)
##--------------------- Find unique fraction of URLs that the crawler got
## DQN crawler
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
setkey(dt_reward, domain); setkey(dqn_all_urls, domain)
dqn_all_urls <- merge(dqn_all_urls, dt_reward, all.x=TRUE)
# dqn_all_urls$reward_domain <- 0
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
dqn_all_urls$pages_crawled <- dqn_all_urls$step
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
# Random crawler
r_all_urls <- data.table(read.csv("results/random_crawler_results/random_all_urls.csv", header=FALSE))
names(r_all_urls) <- c('url', 'reward')
r_all_urls$step <- 1:nrow(r_all_urls)
r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("www.","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("http://","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("https://","", x))
r_all_urls[grepl("}", r_all_urls$domain)]$domain <- ""
setkey(r_all_urls, domain)
r_all_urls <- merge(r_all_urls, dt_reward, all.x=TRUE)
r_all_urls[is.na(vert_code)]$reward <- 0
r_all_urls <- subset(r_all_urls, select=-c(url.y, vert_code))
r_all_urls$cum_reward <- cumsum(r_all_urls$reward)
r_all_urls$pages_crawled <- r_all_urls$step
setkey(r_all_urls, step)
unique_rewards <- subset(r_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
r_all_urls <- merge(r_all_urls, unique_rewards, all.x=TRUE)
r_all_urls[1]$unique_reward_count <- ifelse(is.na(r_all_urls[1]$unique_reward_count), 0, 1)
r_all_urls$unique_reward_count <- na.locf(r_all_urls$unique_reward_count)
## Combine and plot rewards
dqn_all_urls$type <- "Q-learning Agent"
r_all_urls$type <- "Random Crawler"
results_df <- rbind(dqn_all_urls, r_all_urls)
g_reward <- ggplot(data=results_df, aes(x=pages_crawled, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward')
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
g_reward
View(results_df)
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
setkey(dt_reward, domain); setkey(dqn_all_urls, domain)
dqn_all_urls <- merge(dqn_all_urls, dt_reward, all.x=TRUE)
# dqn_all_urls$reward_domain <- 0
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
library(data.table)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(zoo)
#-------------------- Read random train results data
# random_results <- read.csv("results/random_crawler_results_backlinks.csv")
random_results <- read.csv("results/random_crawler_results/random_crawler_results_revisit.csv")
random_results$type <- "Random Crawler"
# dqn_results <- read.csv("results/dqn_crawler_train_results_backlinks.csv")
dqn_results <- read.csv("results/linear_dqn_results/dqn_crawler_train_results_revisit.csv")
# dqn_results <- read.csv("results/dqn_crawler_test_results.csv")
dqn_results$type <- "Q-Learning Agent"
df <- rbind(random_results, subset(dqn_results, select=-c(nn_loss)))
# df <- rbind(random_results, dqn_results)
df$type <- factor(df$type)
##--------------------- Find unique fraction of URLs that the crawler got
## DQN crawler
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
dqn_all_urls$pages_crawled <- dqn_all_urls$step
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
dqn_all_urls$step <- NULL
dqn_all_urls <- dqn_all_urls[order(cum_rewards)]
dqn_all_urls <- dqn_all_urls[order(cum_reward)]
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
dqn_all_urls$step <- NULL
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
dqn_all_urls <- dqn_all_urls[order(cum_reward)]
library(data.table)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(zoo)
#-------------------- Read random train results data
# random_results <- read.csv("results/random_crawler_results_backlinks.csv")
random_results <- read.csv("results/random_crawler_results/random_crawler_results_revisit.csv")
random_results$type <- "Random Crawler"
# dqn_results <- read.csv("results/dqn_crawler_train_results_backlinks.csv")
dqn_results <- read.csv("results/linear_dqn_results/dqn_crawler_train_results_revisit.csv")
# dqn_results <- read.csv("results/dqn_crawler_test_results.csv")
dqn_results$type <- "Q-Learning Agent"
df <- rbind(random_results, subset(dqn_results, select=-c(nn_loss)))
# df <- rbind(random_results, dqn_results)
df$type <- factor(df$type)
##--------------------- Find unique fraction of URLs that the crawler got
## DQN crawler
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
# Random crawler
r_all_urls <- data.table(read.csv("results/random_crawler_results/random_all_urls.csv", header=FALSE))
names(r_all_urls) <- c('url', 'reward')
r_all_urls$step <- 1:nrow(r_all_urls)
r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("www.","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("http://","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("https://","", x))
r_all_urls[grepl("}", r_all_urls$domain)]$domain <- ""
r_all_urls <- merge(r_all_urls, dt_reward, by="domain", all.x=TRUE)
r_all_urls[is.na(vert_code)]$reward <- 0
r_all_urls <- subset(r_all_urls, select=-c(url.y, vert_code))
setkey(r_all_urls, step)
unique_rewards <- subset(r_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
r_all_urls <- merge(r_all_urls, unique_rewards, all.x=TRUE)
r_all_urls[1]$unique_reward_count <- ifelse(is.na(r_all_urls[1]$unique_reward_count), 0, 1)
r_all_urls$unique_reward_count <- na.locf(r_all_urls$unique_reward_count)
r_all_urls$cum_reward <- cumsum(r_all_urls$reward)
## Combine and plot rewards
dqn_all_urls$type <- "Q-learning Agent"
r_all_urls$type <- "Random Crawler"
results_df <- rbind(dqn_all_urls, r_all_urls)
g_reward <- ggplot(data=results_df, aes(x=pages_crawled, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward')
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
g_reward
## Combine and plot rewards
dqn_all_urls$type <- "Q-learning Agent"
r_all_urls$type <- "Random Crawler"
results_df <- rbind(dqn_all_urls, r_all_urls)
g_reward <- ggplot(data=results_df, aes(x=step, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward')
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
g_reward
library(data.table)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(zoo)
#-------------------- Read random train results data
# random_results <- read.csv("results/random_crawler_results_backlinks.csv")
random_results <- read.csv("results/random_crawler_results/random_crawler_results_revisit.csv")
random_results$type <- "Random Crawler"
# dqn_results <- read.csv("results/dqn_crawler_train_results_backlinks.csv")
dqn_results <- read.csv("results/linear_dqn_results/dqn_crawler_train_results_revisit.csv")
# dqn_results <- read.csv("results/dqn_crawler_test_results.csv")
dqn_results$type <- "Q-Learning Agent"
df <- rbind(random_results, subset(dqn_results, select=-c(nn_loss)))
# df <- rbind(random_results, dqn_results)
df$type <- factor(df$type)
##--------------------- Find unique fraction of URLs that the crawler got
## DQN crawler
dqn_all_urls <- data.table(read.csv("results/linear_dqn_results/all_urls.csv", header=FALSE))
names(dqn_all_urls) <- c('url', 'reward', 'is_terminal')
dqn_all_urls$step <- 1:nrow(dqn_all_urls)
dqn_all_urls$domain <- sapply(dqn_all_urls$url, function(x) sub("/.*$","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("www.","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("http://","", x))
dqn_all_urls$domain <- sapply(dqn_all_urls$domain, function(x) sub("https://","", x))
dqn_all_urls[grepl("}", dqn_all_urls$domain)]$domain <- ""
dt_reward <- data.table(df_reward)
dt_reward$domain <- sapply(dt_reward$url, function(x) sub("www.","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("http://","", x))
dt_reward$domain <- sapply(dt_reward$domain, function(x) sub("https://","", x))
dqn_all_urls <- merge(dqn_all_urls, dt_reward, by="domain", all.x=TRUE)
dqn_all_urls[is.na(vert_code)]$reward <- 0
dqn_all_urls <- subset(dqn_all_urls, select=-c(url.y, vert_code))
setkey(dqn_all_urls, step)
unique_rewards <- subset(dqn_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
dqn_all_urls <- merge(dqn_all_urls, unique_rewards, all.x=TRUE)
dqn_all_urls[1]$unique_reward_count <- ifelse(is.na(dqn_all_urls[1]$unique_reward_count), 0, 1)
dqn_all_urls$unique_reward_count <- na.locf(dqn_all_urls$unique_reward_count)
dqn_all_urls$is_terminal <- NULL
dqn_all_urls$cum_reward <- cumsum(dqn_all_urls$reward)
# Random crawler
r_all_urls <- data.table(read.csv("results/random_crawler_results/random_all_urls.csv", header=FALSE))
names(r_all_urls) <- c('url', 'reward')
r_all_urls$step <- 1:nrow(r_all_urls)
r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$url, function(x) sub("/.*$","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("www.","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("http://","", x))
r_all_urls$domain <- sapply(r_all_urls$domain, function(x) sub("https://","", x))
r_all_urls[grepl("}", r_all_urls$domain)]$domain <- ""
r_all_urls <- merge(r_all_urls, dt_reward, by="domain", all.x=TRUE)
r_all_urls[is.na(vert_code)]$reward <- 0
r_all_urls <- subset(r_all_urls, select=-c(url.y, vert_code))
setkey(r_all_urls, step)
unique_rewards <- subset(r_all_urls[reward==1], select=c(step, domain))
unique_rewards <- unique_rewards[!duplicated(subset(unique_rewards, select=domain))]
unique_rewards$unique_reward_count <- 1:nrow(unique_rewards)
unique_rewards$domain <- NULL
setkey(unique_rewards, step)
r_all_urls <- merge(r_all_urls, unique_rewards, all.x=TRUE)
r_all_urls[1]$unique_reward_count <- ifelse(is.na(r_all_urls[1]$unique_reward_count), 0, 1)
r_all_urls$unique_reward_count <- na.locf(r_all_urls$unique_reward_count)
r_all_urls$cum_reward <- cumsum(r_all_urls$reward)
## Combine and plot rewards
dqn_all_urls$type <- "Q-learning Agent"
r_all_urls$type <- "Random Crawler"
results_df <- rbind(dqn_all_urls, r_all_urls)
g_reward <- ggplot(data=results_df, aes(x=step, y=cum_reward, color=type))
g_reward <- g_reward + geom_line(size=0.9) + labs(x='Pages Crawled', y='Total Reward')
g_reward <- g_reward + theme(legend.position='top')
g_reward <- g_reward + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
## Combine and plot unique rewards
g_uniq <- ggplot(data=results_df, aes(x=step, y=unique_reward_count, color=type))
g_uniq <- g_uniq + geom_line(size=0.9) + labs(x='Pages Crawled', y='Unique Rewards')
g_uniq <- g_uniq + theme(legend.position="top")
g_uniq <- g_uniq + scale_x_continuous(labels=comma) + scale_y_continuous(labels=comma)
##-------------------------------------- Combine plots
# Share legend function
grid_arrange_shared_legend <- function(..., nrow = 1, ncol = length(list(...)), position = c("bottom", "right")) {
plots <- list(...)
position <- match.arg(position)
g <- ggplotGrob(plots[[1]] + theme(legend.position = position))$grobs
legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
lheight <- sum(legend$height)
lwidth <- sum(legend$width)
gl <- lapply(plots, function(x) x + theme(legend.position = "none"))
gl <- c(gl, nrow = nrow, ncol = ncol)
combined <- switch(position,
"bottom" = arrangeGrob(do.call(arrangeGrob, gl),
legend,
ncol = 1,
heights = unit.c(unit(1, "npc") - lheight, lheight)),
"right" = arrangeGrob(do.call(arrangeGrob, gl),
legend,
ncol = 2,
widths = unit.c(unit(1, "npc") - lwidth, lwidth)))
grid.newpage()
grid.arrange(combined)
}
# Combine
g <- grid_arrange_shared_legend(g_reward, g_uniq, nrow = 1, ncol = 2)
g
ggsave(filename="../figures/our_work/dqn_vs_random.png", plot=g, width = 15, height = 10, units = "cm")
